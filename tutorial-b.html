<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<title></title>
<body>
<h2>Skywriting Tutorial</h2>
<p>Skywriting is a task-parallel language and execution engine for programming clusters of computing resources.
It has a familiar Javascript-like syntax, but with a few changes to adapt it to a parallel environment.</p>
<p>In this intermediate tutorial, we describe how to implement the Smith-Waterman string matching algorithm. This is a realistic algorithm often used in biology and bioinformatics.</p>
<div class="codehilite"><pre><span class="nx">num_rows</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
<span class="nx">num_cols</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>

<span class="nx">horiz_source</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="s2">&quot;http://www.cl.cam.ac.uk/~dgm36/horizontal_string_random&quot;</span><span class="p">);</span>
<span class="nx">vert_source</span> <span class="o">=</span> <span class="nx">ref</span><span class="p">(</span><span class="s2">&quot;http://www.cl.cam.ac.uk/~dgm36/vertical_string_random&quot;</span><span class="p">);</span>
<span class="nx">java_lib</span> <span class="o">=</span> <span class="p">[</span><span class="nx">ref</span><span class="p">(</span><span class="s2">&quot;http://www.cl.cam.ac.uk/~dgm36/dp.jar&quot;</span><span class="p">)];</span>

<span class="nx">horiz_chunks</span> <span class="o">=</span> <span class="nx">spawn_exec</span><span class="p">(</span><span class="s2">&quot;java&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;inputs&quot;</span><span class="o">:</span><span class="p">[</span><span class="nx">horiz_source</span><span class="p">],</span> <span class="s2">&quot;lib&quot;</span><span class="o">:</span><span class="nx">java_lib</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="o">:</span><span class="s2">&quot;tests.dp.PartitionInputString&quot;</span><span class="p">,</span> <span class="s2">&quot;argv&quot;</span><span class="o">:</span><span class="p">[]},</span> <span class="nx">num_cols</span><span class="p">);</span>
<span class="nx">vert_chunks</span> <span class="o">=</span> <span class="nx">spawn_exec</span><span class="p">(</span><span class="s2">&quot;java&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;inputs&quot;</span><span class="o">:</span><span class="p">[</span><span class="nx">vert_source</span><span class="p">],</span> <span class="s2">&quot;lib&quot;</span><span class="o">:</span><span class="nx">java_lib</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="o">:</span><span class="s2">&quot;tests.dp.PartitionInputString&quot;</span><span class="p">,</span> <span class="s2">&quot;argv&quot;</span><span class="o">:</span><span class="p">[]},</span> <span class="nx">num_rows</span><span class="p">);</span>

<span class="nx">blocks</span> <span class="o">=</span> <span class="p">[];</span>
<span class="nx">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>

<span class="nx">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">spawn_exec</span><span class="p">(</span><span class="s2">&quot;java&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;argv&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;tl&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;lib&quot;</span><span class="o">:</span><span class="nx">java_lib</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="o">:</span><span class="s2">&quot;tests.dp.SmithWaterman&quot;</span><span class="p">,</span> <span class="s2">&quot;inputs&quot;</span><span class="o">:</span><span class="p">[</span><span class="nx">horiz_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">vert_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">]]},</span> <span class="mi">3</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="k">in</span> <span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">num_cols</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">spawn_exec</span><span class="p">(</span><span class="s2">&quot;java&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;argv&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;lib&quot;</span><span class="o">:</span><span class="nx">java_lib</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="o">:</span><span class="s2">&quot;tests.dp.SmithWaterman&quot;</span><span class="p">,</span> <span class="s2">&quot;inputs&quot;</span><span class="o">:</span><span class="p">[</span><span class="nx">horiz_chunks</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">vert_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">blocks</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="nx">j</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]]},</span> <span class="mi">3</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="k">in</span> <span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">num_rows</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">spawn_exec</span><span class="p">(</span><span class="s2">&quot;java&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;argv&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;lib&quot;</span><span class="o">:</span><span class="nx">java_lib</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="o">:</span><span class="s2">&quot;tests.dp.SmithWaterman&quot;</span><span class="p">,</span> <span class="s2">&quot;inputs&quot;</span><span class="o">:</span><span class="p">[</span><span class="nx">horiz_chunks</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">vert_chunks</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]]},</span> <span class="mi">3</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="k">in</span> <span class="nx">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">num_cols</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">]</span> <span class="o">=</span> <span class="nx">spawn_exec</span><span class="p">(</span><span class="s2">&quot;java&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;argv&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;i&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s2">&quot;lib&quot;</span><span class="o">:</span><span class="nx">java_lib</span><span class="p">,</span> <span class="s2">&quot;class&quot;</span><span class="o">:</span><span class="s2">&quot;tests.dp.SmithWaterman&quot;</span><span class="p">,</span> <span class="s2">&quot;inputs&quot;</span><span class="o">:</span><span class="p">[</span><span class="nx">horiz_chunks</span><span class="p">[</span><span class="nx">j</span><span class="p">],</span> <span class="nx">vert_chunks</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="nx">j</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="nx">j</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]]},</span> <span class="mi">3</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nx">ignore</span> <span class="o">=</span> <span class="nx">exec</span><span class="p">(</span><span class="s2">&quot;stdinout&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;inputs&quot;</span><span class="o">:</span><span class="p">[</span><span class="nx">blocks</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="s2">&quot;command_line&quot;</span><span class="o">:</span><span class="p">[</span><span class="s2">&quot;cat&quot;</span><span class="p">]},</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">return</span> <span class="nx">ignore</span><span class="p">;</span>
</pre></div></body>
